apiVersion: scaffolder.backstage.io/v1beta3
kind: Template
metadata:
  name: create-dns-record
  title: Create Public DNS Record 
  description: PR to create a public DNS record
  tags:
    - infrastructure
    - terraform
    - azure
    - dns
  links:
    - title: Documentation
      url: https://backstage.io/docs/features/software-templates
      icon: docs
    - title: Source
      url: https://github.com.br/gabriel-dantas98/backstage-scaffolders/blob/main/basic-react-app/create-web-app.yaml
      icon: github

spec:
  owner: cloud_platform
  type: infra-a-code

  parameters:
  - title: Create a DNS record
    required:
        - dns_zone
        - record_name
        - record_value
        - record_ttl
    properties:
      dns_zone:
        title: DNS Zone name
        type: string
        enum:
          - platforms.hmcts.net
          - hmcts.net
      record_name:
        title: DNS record name
        type: string
        description: |
          The name of the record to create
      record_value:
        title: DNS record value
        type: string
        description: |
          The value of the record to create
      record_ttl:
        title: DNS record time to live
        type: number
        description: |
          The TTL of the record
  - title: Which environments to deploy the record to?
    required:
      - environments
    properties:
      environments:
        title: Select environments
        type: array
        items:
          type: string
          enum:
            - sbox 
            - dev 
            - ithc
            - demo
            - staging
            - prod
        uniqueItems: true
        ui:widget: checkboxes
  - title: Which platform is this for?
    required:
      - cft_sds
    properties:
      cft_sds:
        title: Which platform does this DNS belong to? 
        type: string
        description: The DNS record should be assigned to a platform
        enum:
          - cft
          - sds
        ui:widget: radio

  steps:
    - id: writeFile
      name: Create File
      action: roadiehq:utils:fs:write
      input:
        path: test.yaml
        content: |
          dns_zone: ${{ parameters.dns_zone }}
          record_name: ${{ parameters.record_name }}
          record_value: ${{ parameters.record_value }}
          record_ttl: ${{ parameters.record_ttl }}

    - id: show_workspace
      name: Show workspace files
      action: debug:log
      input:
        listWorkspace: true

    - id: parsefile
      name: Parse File
      action: roadiehq:utils:fs:parse
      input:
        path: test.yaml
        parser: yaml

    - id: serialize
      name: serialize
      action: roadiehq:utils:serialize:yaml
      input:
        data:
          hello: world
          # ${{ steps.parsefile.output.content }}

  output:
    yaml: ${{ steps.serialize.output.serialized }}